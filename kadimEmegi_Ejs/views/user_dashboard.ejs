<%- include('partials/header', { title: 'Kullanıcı Dashboard' }) %>
<h1>Hoş Geldiniz, <%= user.first_name %> <%= user.last_name %></h1>

<h2>Tüm İlanlar</h2>
<% if (allListings.length > 0) { %>
  <ul>
    <% allListings.forEach(listing => { %>
      <li>
        <strong><%= listing.title %></strong> - <%= listing.price %> TL
        <br>
        <small>Ekleyen: <%= listing.username %></small>
        <br>
        <small>Kategori: <%= listing.category %></small>
        <br>
        <small>Açıklama: <%= listing.description %></small>
        <br>
        <img src="<%= listing.image_path %>" alt="<%= listing.title %>" style="max-width: 200px;">
        
        <!-- Sepete Ekle Butonu -->
        <form method="POST" action="/cart/add">
          <input type="hidden" name="listing_id" value="<%= listing.id %>">
          <input type="number" name="quantity" value="1" min="1">
          <button type="submit">Sepete Ekle</button>
        </form>
      </li>
    <% }); %>
  </ul>
<% } else { %>
  <p>Henüz bir ilan eklenmedi.</p>
<% } %>


<hr>

<h2>Senin İlanların</h2>
<% if (userListings.length > 0) { %>
  <ul>
    <% userListings.forEach(listing => { %>
      <li>
        <strong><%= listing.title %></strong> - <%= listing.price %> TL
        <br>
        <a href="/listings/<%= listing.id %>/edit">Düzenle</a> |
        <a href="/listings/<%= listing.id %>/delete" onclick="return confirm('Bu ilanı silmek istediğinize emin misiniz?')">Sil</a>
      </li>
    <% }); %>
  </ul>
<% } else { %>
  <p>Henüz bir ilan eklemediniz.</p>
<% } %>

<h2>Sertifikalarınız</h2>
<% if (certificates.length > 0) { %>
  <ul>
    <% certificates.forEach(certificate => { %>
      <li>
        <h3><%= certificate.certificate_name %></h3>
        <img src="<%= certificate.certificate_path %>" alt="<%= certificate.certificate_name %>" />
        <a href="/certificates/<%= certificate.id %>/delete">Sil</a>
      </li>
    <% }); %>
  </ul>
<% } else { %>
  <p>Henüz sertifikanız yok.</p>
  <a href="/certificates/upload">Yeni Sertifika Ekle</a>
<% } %>
<h2>Sepetiniz</h2>
<% if (cartItems.length > 0) { %>
  <ul>
    <% cartItems.forEach(item => { %>
      <li>
        <strong><%= item.title %></strong> - <%= item.quantity %> adet - <%= item.price * item.quantity %> TL
        <br>
        <img src="<%= item.image_path %>" alt="<%= item.title %>" style="max-width: 200px;">
        
        <!-- Sepetten Çıkarma Butonu -->
        <form method="POST" action="/cart/remove">
          <input type="hidden" name="cartId" value="<%= item.id %>">
          <button type="submit">Sepetten Çıkar</button>
        </form>
      </li>
    <% }); %>
  </ul>
  <a href="/orders/checkout">Ödeme Sayfasına Git</a>
<% } else { %>
  <p>Sepetinizde ürün bulunmamaktadır.</p>
<% } %>


<h2>Mesajlarınız</h2>
<% if (messages.length > 0) { %>
  <ul>
    <% messages.forEach(message => { %>
      <li>
        <p><%= message.content %></p>
        <p>Gönderen: <%= message.sender_username %></p>
        <p>Tarih: <%= message.sent_at %></p>
      </li>
    <% }); %>
  </ul>
<% } else { %>
  <p>Henüz mesajınız yok.</p>
<% } %>

<%- include('partials/footer') %>
